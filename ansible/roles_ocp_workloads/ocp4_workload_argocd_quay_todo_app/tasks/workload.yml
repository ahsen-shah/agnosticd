---
# Implement your Workload deployment tasks here


- name: Install Gitea
  ansible.builtin.include_role:
    name: ocp4_workload_gitea_operator

- name: Wait for Gitea route to be available
  kubernetes.core.k8s_info:
    api_version: gpte.opentlc.com/v1
    kind: Gitea
    name: "{{ ocp4_workload_gitea_operator_name }}"
    namespace: "{{ ocp4_workload_gitea_operator_project }}"
  register: r_gitea
  until: r_gitea.resources[0].status.giteaRoute is defined
  retries: 90
  delay: 10

#- name: Install GitOps
#  ansible.builtin.include_role:
#    name: ocp4_workload_openshift_gitops

#- name: Set gitea route
#  set_fact:
#    ocp4_workload_argocd_quay_todo_app_gitea_route: "{{ r_gitea.resources[0].status.giteaRoute }}"

#- name: Set gitea repo url
#  set_fact:
#    ocp4_workload_argocd_quay_todo_app_gitea_repo_url: "{{ ocp4_workload_argocd_quay_todo_app_gitea_route }}/{{ ocp4_workload_gitea_aiml_user }}/gitops.git"

#- name: Install Gitops Repo Secret
#  kubernetes.core.k8s:
#    state: present
#    merge_type:
#      - strategic-merge
#      - merge
#    definition: "{{ lookup('template', './templates/gitops-repo-secret.yml.j2') }}"


# Leave this as the last task in the playbook.
- name: workload tasks complete
  debug:
    msg: "Workload Tasks completed successfully."
  when: not silent